<!DOCTYPE html>
<html>
  <head>
    <title>Session details</title>
    <link
      rel="shortcut icon"
      href="{{ url_for('static',filename='logo.png')}}"
    />
    <style>
      .table-container {
        max-height: 600px;
        overflow-y: scroll;
      }
      table {
        margin-top: 20px;
        border-collapse: collapse;
        width: 100%;
      }

      th,
      td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      th {
        background-color: #1877f2;
        position: sticky;
        color: #fff;
        font-weight: bold;
        top: 0;
        z-index: 1;
      }

      tr:hover {
        background-color: #daeaff;
      }

      caption {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      tr:nth-child(even) {
        background-color: #eaf3ff;
      }

      tr {
        height: 40px;
      }
    </style>
    <div
      style="
        display: flex;
        justify-content: right;
        margin-right: 60px;
        margin-top: 30px;
      "
    >
      <a href="/"
        ><img src="https://www.digi-val.com/assets/img/logo.svg" alt=""
      /></a>
    </div>
  </head>
  <body>
    <div
      style="
        justify-content: center;
        align-items: center !important;
        margin-top: 30px;
        margin-top: -79px;
      "
    >
      <h2>Number of Sessions conducted: {{number_of_sessions}}</h2>
      <div><h3>Sum of auto : {{ auto_p_sum }}</h3></div>
      <h3>Sum of manual: {{ manual_p_sum }}</h3>
    </div>

    <div
      style="
        display: flex;
        justify-content: left;
        margin-right: 800px;
        align-items: center;
        margin-top: 60px;
      "
    >
      <canvas id="donutChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Access the sums passed from Flask
      var autoPSum = {{ auto_p_sum }};
      var manualPSum = {{ manual_p_sum }};

      // Create the donut chart
      var ctx = document.getElementById('donutChart').getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['auto present', 'manual present'],
          datasets: [
            {
              data: [autoPSum, manualPSum],
              backgroundColor: ['rgb(24,119,242)', 'rgb(255,0,0)'],
              hoverOffset: 15, // Add a small hover offset
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '50%', // Adjust the cutout percentage for the donut shape
          plugins: {
            legend: {
              display: true, // You can choose to display or hide the legend as needed
            },
          },
        },
      });
    </script>

    <div
      style="
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 50px;
      "
    >
      <h2>Session conducted on {{date}} using {{infra}}</h2>
    </div>
    <div
      class="table-container"
      style="overflow-x: auto; max-width: 100%; margin-top: 20px"
    >
      <table>
        <thead class="sticky-header">
          <tr>
            {% for column in table.columns %}
            <th>{{ column }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in table.iterrows() %}
          <tr>
            {% for cell in row[1] %}
            <td>{{ cell }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <form id="myForm" method="POST" action="/">
      <input type="hidden" name="date" id="date-input" />
      <input type="hidden" name="name" id="name-input" />
    </form>

    <script>
      // Get all the table rows
      const rows = document.querySelectorAll(".table-container tbody tr");

      // Add click event listener to each row
      rows.forEach((row) => {
        row.addEventListener("click", () => {
          // Get the values from session_date and infra_name cells
          const sessionDate = row.querySelector("td:nth-child(1)").textContent;
          const infraName = row.querySelector("td:nth-child(2)").textContent;

          // Set the values in the form
          document.getElementById("date-input").value = sessionDate;
          document.getElementById("name-input").value = infraName;

          // Submit the form
          document.getElementById("myForm").submit();
        });
      });
    </script>
  </body>
</html>
